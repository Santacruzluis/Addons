<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="free_form_invoice_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="custom_print.free_form_template" t-lang="o.partner_id.lang" />
            </t>
        </t>
    </template>

    <template id="free_form_template">
        <t t-call="custom_print.custom_external_layout">
            <div class="article" style="font-family: 'Arial'; font-size: 8px; line-height: 1;">
                <div class="row mb-1">
                    <div class="col-4">
                        <strong>Cliente:</strong>
                        <span t-field="o.partner_id" />
                        <br />
                        <strong>RIF:</strong>
                        <span t-field="o.partner_id.vat" />
                        <br />
                        <strong>Dirección:</strong>
                        <span t-out="o.partner_id._display_address(True)" /> -
                        <span t-field="o.partner_id.phone" />
                    </div>
                    <div class="col-4 text-center">
                        <h5 style="margin: 0; font-size: 9px; font-weight: bold;" t-if="o.move_type == 'out_invoice'">Factura</h5>
                        <h5 style="margin: 0; font-size: 9px; font-weight: bold;" t-if="o.move_type == 'out_refund'">Nota de Crédito</h5>
                        <h5 style="margin: 0; font-size: 9px; font-weight: bold;" t-if="o.move_type == 'in_invoice'">Factura de Proveedor</h5>
                        <h5 style="margin: 0; font-size: 9px; font-weight: bold;" t-if="o.move_type == 'in_refund'">Nota de Crédito de Proveedor</h5>
                    </div>
                    <div class="col-4 text-end">
                        <strong t-if="o.move_type == 'out_invoice'">Número:</strong>
                        <strong t-if="o.move_type == 'out_refund'">Número:</strong>
                        <strong t-if="o.move_type == 'in_invoice'">Número:</strong>
                        <strong t-if="o.move_type == 'in_refund'">Número:</strong>
                        <span t-field="o.name" />
                        <br />
                        <strong>Fecha:</strong>
                        <span t-field="o.invoice_date"/>
                        <br />
                        <strong>Vencimiento:</strong>
                        <span t-field="o.invoice_date_due" />
                    </div>
                </div>
                <div>
                    <t t-set="show_discount" t-value="any(o.invoice_line_ids.mapped('discount'))"/>
                    <table class="table table-sm" style="margin-bottom: 2px; font-size: 7px;">
                        <thead>
                            <tr style="border-top: 1px solid #dee2e6; border-bottom: 1px solid #dee2e6;">
                                <th class="text-center" style="padding: 1px; width: 3%;">#</th>
                                <th class="text-start" style="padding: 1px; width: 40%;">Descripción</th>
                                <th class="text-end" style="padding: 1px; width: 10%;">P.Unit.</th>
                                <th class="text-end" style="padding: 1px; width: 6%;">Cant.</th>
                                <th class="text-start" style="padding: 1px; width: 6%;">Unidad</th>
                                <th t-if="show_discount" class="text-end" style="padding: 1px; width: 6%;">Desc.%</th>
                                <th class="text-end" style="padding: 1px; width: 10%;">Subtotal</th>
                                <th class="text-end" style="padding: 1px; width: 10%;">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="line_number" t-value="1"/>
                            <tr t-foreach="o.invoice_line_ids" t-as="line" style="line-height: 1;">
                                <td class="text-center" style="padding: 1px; vertical-align: top;">
                                    <t t-esc="line_number"/>
                                    <t t-set="line_number" t-value="line_number + 1"/>
                                </td>
                                <td style="padding: 1px; vertical-align: top;">
                                    <span t-field="line.name"/>
                                    <span t-if="line.price_total == line.price_subtotal">(E)</span>
                                </td>
                                <td class="text-end" style="padding: 1px; vertical-align: top;">
                                    <span t-field="line.price_unit" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                </td>
                                <td class="text-end" style="padding: 1px; vertical-align: top;">
                                    <span t-field="line.quantity"/>
                                </td>
                                <td style="padding: 1px; vertical-align: top;">
                                    <span t-field="line.product_uom_id.name" t-options='{"widget": "text"}'/>
                                </td>
                                <td t-if="show_discount" class="text-end" style="padding: 1px; vertical-align: top;">
                                    <span t-field="line.discount"/>%
                                </td>
                                <td class="text-end" style="padding: 1px; vertical-align: top;">
                                    <span t-field="line.price_subtotal" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                </td>
                                <td class="text-end" style="padding: 1px; vertical-align: top;">
                                    <span t-field="line.price_total" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="row" style="border-top: 1px solid #dee2e6; margin-top: 0;">
                    <div class="col-7">
                        <div style="font-size: 7px; margin-top: 5px;">
                            <strong>Notas:</strong>
                            <p t-field="o.narration" style="margin-bottom: 2px;"/>
                        </div>
                    </div>
                    <div class="col-5">
                        <table class="table table-sm table-borderless" style="margin-bottom: 0; font-size: 8px;">
                            <tr t-if="o.amount_untaxed">
                                <td class="text-end" style="padding: 1px;"><strong>Subtotal:</strong></td>
                                <td class="text-end" style="padding: 1px;">
                                    <span t-field="o.amount_untaxed" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                </td>
                            </tr>
                            <tr t-foreach="o.amount_by_group" t-as="tax_group">
                                <td class="text-end" style="padding: 1px;">
                                    <span t-esc="tax_group[0]"/>
                                </td>
                                <td class="text-end" style="padding: 1px;">
                                    <span t-esc="tax_group[1]" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-end" style="padding: 1px;"><strong>Total:</strong></td>
                                <td class="text-end" style="padding: 1px;">
                                    <strong>
                                        <span t-field="o.amount_total" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </strong>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <record id="action_report_custom_invoice" model="ir.actions.report">
        <field name="name">Factura Personalizada</field>
        <field name="model">account.move</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">custom_print.free_form_invoice_template</field>
        <field name="report_file">custom_print.free_form_invoice_template</field>
        <field name="print_report_name">'Factura - %s' % (object.name)</field>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="custom_print.paperformat_letter"/>
    </record>
</odoo>